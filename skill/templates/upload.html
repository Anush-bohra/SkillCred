{% extends "base.html" %}

{% block title %}Upload Resume - SkillCred{% endblock %}

{% block content %}
<div class="d-flex justify-between align-center mb-6">
    <div>
        <h1>Upload Resumes</h1>
        <p class="text-secondary">Upload PDF or DOCX resumes for instant verification and trust scoring</p>
    </div>
    <a href="{{ url_for('dashboard') }}" class="btn btn-outline">
        <i class="fas fa-arrow-left"></i>
        Back to Dashboard
    </a>
</div>

<!-- Upload Section -->
<div class="card mb-6">
    <div class="card-header">
        <h3 class="card-title">Drag & Drop Upload</h3>
        <p class="card-subtitle">Upload multiple resumes at once for bulk processing</p>
    </div>

    <div id="uploadZone" class="upload-zone">
        <div class="upload-icon">
            <i class="fas fa-cloud-upload-alt"></i>
        </div>
        <div class="upload-text">Drop your resume files here</div>
        <div class="upload-subtext">or <strong>click to browse</strong> your computer</div>
        <div class="upload-subtext mt-2">
            Supports PDF and DOCX files up to 16MB each
        </div>

        <input type="file" id="fileInput" multiple accept=".pdf,.docx,.doc" style="display: none;">
    </div>

    <div class="d-flex justify-between align-center mt-4">
        <div class="text-muted">
            <i class="fas fa-info-circle"></i>
            Files are processed securely and stored temporarily for verification
        </div>
        <button id="uploadBtn" class="btn btn-primary">
            <i class="fas fa-folder-open"></i>
            Browse Files
        </button>
    </div>
</div>

<!-- File Queue -->
<div class="card mb-6" style="display: none;" id="fileQueueCard">
    <div class="card-header">
        <h3 class="card-title">Upload Queue</h3>
        <p class="card-subtitle">Review files before processing</p>
    </div>

    <div id="fileList"></div>

    <div class="d-flex justify-between align-center mt-4">
        <div class="text-muted">
            <span id="fileCount">0</span> file(s) ready for processing
        </div>
        <div class="d-flex gap-3">
            <button id="clearQueue" class="btn btn-outline">
                <i class="fas fa-trash"></i>
                Clear Queue
            </button>
            <button id="bulkUpload" class="btn btn-primary">
                <i class="fas fa-play"></i>
                Process All Files
            </button>
        </div>
    </div>
</div>

<!-- Processing Status -->
<div class="card mb-6" style="display: none;" id="processingCard">
    <div class="card-header">
        <h3 class="card-title">Processing Status</h3>
        <p class="card-subtitle">Real-time verification progress</p>
    </div>

    <div class="d-flex align-center gap-4 mb-4">
        <div class="d-flex align-center gap-2">
            <div class="loading"></div>
            <span>Processing resumes...</span>
        </div>
        <div class="progress" style="flex: 1;">
            <div id="overallProgress" class="progress-bar" style="width: 0%"></div>
        </div>
        <span id="progressText">0%</span>
    </div>

    <div class="stats-grid" style="grid-template-columns: repeat(4, 1fr);">
        <div class="stat-card">
            <div class="stat-value" id="processedCount">0</div>
            <div class="stat-label">Processed</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="verifiedCount">0</div>
            <div class="stat-label">Verified</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="flaggedCount">0</div>
            <div class="stat-label">Flagged</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="errorCount">0</div>
            <div class="stat-label">Errors</div>
        </div>
    </div>
</div>

<!-- Quick Upload Options -->
<div class="card">
    <div class="card-header">
        <h3 class="card-title">Quick Actions</h3>
        <p class="card-subtitle">Common upload scenarios</p>
    </div>

    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">
        <div class="d-flex align-center gap-4 p-4"
            style="border: 1px solid var(--border-color); border-radius: var(--radius-md);">
            <div style="
                width: 60px; 
                height: 60px; 
                background: rgba(59, 130, 246, 0.1); 
                border-radius: 50%; 
                display: flex; 
                align-items: center; 
                justify-content: center;
                color: var(--secondary-color);
            ">
                <i class="fas fa-file-upload" style="font-size: 1.5rem;"></i>
            </div>
            <div style="flex: 1;">
                <h4 class="mb-2">Single Resume</h4>
                <p class="text-muted mb-3" style="font-size: 0.875rem;">
                    Upload and verify one resume with detailed analysis
                </p>
                <button class="btn btn-outline" onclick="document.getElementById('fileInput').click()">
                    <i class="fas fa-upload"></i>
                    Upload Single File
                </button>
            </div>
        </div>

        <div class="d-flex align-center gap-4 p-4"
            style="border: 1px solid var(--border-color); border-radius: var(--radius-md);">
            <div style="
                width: 60px; 
                height: 60px; 
                background: rgba(34, 197, 94, 0.1); 
                border-radius: 50%; 
                display: flex; 
                align-items: center; 
                justify-content: center;
                color: var(--success-color);
            ">
                <i class="fas fa-layer-group" style="font-size: 1.5rem;"></i>
            </div>
            <div style="flex: 1;">
                <h4 class="mb-2">Bulk Processing</h4>
                <p class="text-muted mb-3" style="font-size: 0.875rem;">
                    Upload multiple resumes for batch verification
                </p>
                <button class="btn btn-outline" onclick="document.getElementById('fileInput').click()">
                    <i class="fas fa-layer-group"></i>
                    Bulk Upload
                </button>
            </div>
        </div>

        <div class="d-flex align-center gap-4 p-4"
            style="border: 1px solid var(--border-color); border-radius: var(--radius-md);">
            <div style="
                width: 60px; 
                height: 60px; 
                background: rgba(245, 158, 11, 0.1); 
                border-radius: 50%; 
                display: flex; 
                align-items: center; 
                justify-content: center;
                color: var(--warning-color);
            ">
                <i class="fas fa-search" style="font-size: 1.5rem;"></i>
            </div>
            <div style="flex: 1;">
                <h4 class="mb-2">Quick Scan</h4>
                <p class="text-muted mb-3" style="font-size: 0.875rem;">
                    Fast verification for preliminary screening
                </p>
                <button class="btn btn-outline" onclick="enableQuickScan()">
                    <i class="fas fa-bolt"></i>
                    Quick Scan Mode
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Help Section -->
<div class="card mt-6">
    <div class="card-header">
        <h3 class="card-title">
            <i class="fas fa-question-circle"></i>
            How It Works
        </h3>
    </div>

    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem;">
        <div class="text-center">
            <div style="
                width: 80px; 
                height: 80px; 
                background: var(--secondary-color); 
                border-radius: 50%; 
                display: flex; 
                align-items: center; 
                justify-content: center;
                margin: 0 auto 1rem;
                color: white;
            ">
                <i class="fas fa-upload" style="font-size: 2rem;"></i>
            </div>
            <h4 class="mb-3">1. Upload</h4>
            <p class="text-muted">
                Drop your PDF or DOCX resume files into the upload zone or browse to select them
            </p>
        </div>

        <div class="text-center">
            <div style="
                width: 80px; 
                height: 80px; 
                background: var(--accent-color); 
                border-radius: 50%; 
                display: flex; 
                align-items: center; 
                justify-content: center;
                margin: 0 auto 1rem;
                color: white;
            ">
                <i class="fas fa-cog" style="font-size: 2rem;"></i>
            </div>
            <h4 class="mb-3">2. Process</h4>
            <p class="text-muted">
                Our AI extracts and analyzes claims from resumes using NLP and OCR technology
            </p>
        </div>

        <div class="text-center">
            <div style="
                width: 80px; 
                height: 80px; 
                background: var(--success-color); 
                border-radius: 50%; 
                display: flex; 
                align-items: center; 
                justify-content: center;
                margin: 0 auto 1rem;
                color: white;
            ">
                <i class="fas fa-shield-check" style="font-size: 2rem;"></i>
            </div>
            <h4 class="mb-3">3. Verify</h4>
            <p class="text-muted">
                Claims are verified against blockchain records, APIs, and external data sources
            </p>
        </div>

        <div class="text-center">
            <div style="
                width: 80px; 
                height: 80px; 
                background: var(--primary-color); 
                border-radius: 50%; 
                display: flex; 
                align-items: center; 
                justify-content: center;
                margin: 0 auto 1rem;
                color: white;
            ">
                <i class="fas fa-chart-line" style="font-size: 2rem;"></i>
            </div>
            <h4 class="mb-3">4. Score</h4>
            <p class="text-muted">
                Get a comprehensive trust score and detailed verification report for each resume
            </p>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const fileQueueCard = document.getElementById('fileQueueCard');
        const processingCard = document.getElementById('processingCard');
        const fileCountSpan = document.getElementById('fileCount');
        const clearQueueBtn = document.getElementById('clearQueue');

        // Show file queue when files are added
        const originalAddFileToQueue = window.app.addFileToQueue;
        window.app.addFileToQueue = function (file) {
            originalAddFileToQueue.call(this, file);
            fileQueueCard.style.display = 'block';
            fileCountSpan.textContent = this.uploadedFiles.length;
        };

        // Clear queue functionality
        if (clearQueueBtn) {
            clearQueueBtn.addEventListener('click', function () {
                window.app.uploadedFiles = [];
                window.app.updateFileList();
                fileQueueCard.style.display = 'none';
                fileCountSpan.textContent = '0';
            });
        }

        // Show processing card during bulk upload
        const originalProcessBulkUpload = window.app.processBulkUpload;
        window.app.processBulkUpload = async function () {
            processingCard.style.display = 'block';
            await originalProcessBulkUpload.call(this);
            processingCard.style.display = 'none';
        };
    });

    function enableQuickScan() {
        window.app.quickScanMode = true;
        window.app.showAlert('Quick scan mode enabled. Files will be processed with basic verification.', 'success');
    }
</script>
{% endblock %}